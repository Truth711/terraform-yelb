# terraform-yelb

---
## üìå –û –ø—Ä–æ–µ–∫—Ç–µ
–≠—Ç–æ—Ç —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–æ–¥ –¥–ª—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –æ–±–ª–∞—á–Ω–æ–π –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–π –¥–ª—è –¥–µ–ø–ª–æ—è [pet_pipeline](https://github.com/Truth711/k8s-deploy-yelb). –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –≤–∫–ª—é—á–∞–µ—Ç –≤ —Å–µ–±—è **Yandex Managed Service for Kubernetes**, —Å–µ—Ç—å –¥–ª—è –∫–ª–∞—Å—Ç–µ—Ä–∞, **Yandex Container Registry** –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –æ–±—Ä–∞–∑–æ–≤, —Å–µ—Ä–≤–∏—Å–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –æ–±–ª–∞–∫–æ–º –∏ —Ä–µ—Å—É—Ä—Å—ã –≤–Ω—É—Ç—Ä–∏ –∫–ª–∞—Å—Ç–µ—Ä–∞ (—É–∑–Ω–∞—Ç—å —á—Ç–æ –≥–¥–µ –æ–ø–∏—Å–∞–Ω–æ –º–æ–∂–Ω–æ [–∑–¥–µ—Å—å](#-–ø–µ—Ä–µ—á–µ–Ω—å-—Ä–µ—Å—É—Ä—Å–æ–≤)).

---
## –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ
- [–£—Å—Ç–∞–Ω–æ–≤–∫–∞](#-—É—Å—Ç–∞–Ω–æ–≤–∫–∞)
- [–ü–µ—Ä–µ—á–µ–Ω—å —Ä–µ—Å—É—Ä—Å–æ–≤](#-–ø–µ—Ä–µ—á–µ–Ω—å-—Ä–µ—Å—É—Ä—Å–æ–≤)
- [–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã](#-–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ-–∫–æ–º–∞–Ω–¥—ã)
- [–ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏](#-–ø–æ–ª–µ–∑–Ω—ã–µ-—Å—Å—ã–ª–∫–∏)

---
## üöÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### üîß –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
–ü–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º —Ä–∞–±–æ—Ç—ã –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å:
- **[YC CLI](https://cloud.yandex.ru/docs/cli/quickstart)** ‚Äì —É—Ç–∏–ª–∏—Ç–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Yandex Cloud
- **[Helm](https://helm.sh/docs/intro/install/)** ‚Äì –ø–∞–∫–µ—Ç–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä Kubernetes
- **[Terraform](https://hashicorp-releases.yandexcloud.net/terraform/)** ‚Äì –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π (IaC) (–¥–æ–±–∞–≤—å—Ç–µ –ø—É—Ç—å –¥–æ —Ñ–∞–π–ª–∞ –≤ PATH)
- **[kubectl](https://kubernetes.io/docs/tasks/tools/)** ‚Äì —É—Ç–∏–ª–∏—Ç–∞ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–ª–∞—Å—Ç–µ—Ä–æ–º Kubernetes

### üìå –®–∞–≥–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∏
1. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤**
   
   –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `terraform.rc` –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `%APPDATA%` (Windows) –∏–ª–∏ `~/.terraformrc` (Linux/macOS) —Å–æ —Å–ª–µ–¥—É—é—â–∏–º —Å–æ–¥–µ—Ä–∂–∏–º—ã–º:
   ```hcl
   provider_installation {
     network_mirror {
       url = "https://terraform-mirror.yandexcloud.net/"
       include = ["registry.terraform.io/*/*"]
     }
     direct {
       exclude = ["registry.terraform.io/*/*"]
     }
   }
   ```

2. **–°–∫–æ–ø–∏—Ä—É–π—Ç–µ `var.tfvars.example` –≤ `var.tfvars` –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏**
   
   ```sh
   cp var.tfvars.example var.tfvars
   ```
   –£–∫–∞–∂–∏—Ç–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö (—Ç–æ–∫–µ–Ω, –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã –æ–±–ª–∞–∫–∞, –∫–∞—Ç–∞–ª–æ–≥–æ–≤, –æ—Å—Ç–∞–Ω–æ–µ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ).

3. **–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Terraform**
   
   –í –∫–∞—Ç–∞–ª–æ–≥–µ —Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–º–∏ —Ñ–∞–π–ª–∞–º–∏ Terraform –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É:
   ```sh
   terraform init
   ```
   –≠—Ç–æ —Å–∫–∞—á–∞–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç –æ–∫—Ä—É–∂–µ–Ω–∏–µ.

4. **–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏**
   
   –ó–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É:
   ```sh
   terraform apply -var-file="var.tfvars"
   ```
   –ü—Ä–æ—Å–º–æ—Ç—Ä–∏—Ç–µ —Å–ø–∏—Å–æ–∫ —Å–æ–∑–¥–∞–≤–∞–µ–º—ã—Ö —Ä–µ—Å—É—Ä—Å–æ–≤ –∏ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –∏—Ö —Å–æ–∑–¥–∞–Ω–∏–µ. –ü–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –≤ –ø–∞–ø–∫–µ –ø–æ—è–≤–∏—Ç—Å—è —Ñ–∞–π–ª `ca.pem`, –∫–æ—Ç–æ—Ä—ã–π –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –Ω–∞ —Å–ª–µ–¥—É—é—â–µ–º —à–∞–≥–µ.

5. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–ª–∞—Å—Ç–µ—Ä—É**
   
   –î–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–ª–∞—Å—Ç–µ—Ä—É –±–µ–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è YC CLI (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∏–∑ CI/CD) –≤—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç:
   ```sh
   ./setup-kubeconfig.ps1
   ```
   –í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ —Å–æ–∑–¥–∞—Å—Ç—Å—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –ø–∞–π–ø–ª–∞–π–Ω–∞—Ö.

6. **–£–¥–∞–ª–µ–Ω–∏–µ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã:**

  –£–¥–∞–ª–∏—Ç–µ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É, –∫–æ–≥–¥–∞ –æ–Ω–∞ –±—É–¥–µ—Ç –Ω–µ –Ω—É–∂–Ω–∞:
  ```sh
  terraform destroy -var-file="var.tfvars"
  ```


---
## üìÇ –ü–µ—Ä–µ—á–µ–Ω—å —Ä–µ—Å—É—Ä—Å–æ–≤

- **`cluster.tf`** ‚Äì –æ–ø–∏—Å–∞–Ω–∏–µ –º–∞—Å—Ç–µ—Ä–∞, —É–∑–ª–æ–≤ –∏ –≥—Ä—É–ø–ø –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- **`helm.tf`** ‚Äì —É—Å—Ç–∞–Ω–æ–≤–∫–∞ **nginx-ingress** –∏ **cert-manager** —á–µ—Ä–µ–∑ Helm
- **`kube.tf`** ‚Äì –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–ª–∞—Å—Ç–µ—Ä—É –∏ —Å–æ–∑–¥–∞–Ω–∏–µ **service account**, —Ä–æ–ª–µ–π –∏ **imagePullSecret**
- **`network.tf`** ‚Äì –æ–ø–∏—Å–∞–Ω–∏–µ —Å–µ—Ç–∏, –ø–æ–¥—Å–µ—Ç–µ–π –∏ DNS-–∑–æ–Ω—ã
- **`provider.tf`** ‚Äì –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ Terraform
- **`registry.tf`** ‚Äì —Å–æ–∑–¥–∞–Ω–∏–µ **Yandex Container Registry** –∏ –≥—Ä—É–ø–ø—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –¥–ª—è –Ω–µ–≥–æ
- **`service_account.tf`** ‚Äì —Å–µ—Ä–≤–∏—Å–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç –∏ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –æ–±–ª–∞–∫—É
- **`variables.tf`** ‚Äì –æ–ø–∏—Å–∞–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
- **`var.tfvars`** ‚Äì –∑–Ω–∞—á–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö (—Ç—Ä–µ–±—É–µ—Ç—Å—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ)

---
## üõ† –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

- **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:**
  ```sh
  terraform apply -var-file="var.tfvars"
  ```

- **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è:**
  ```sh
  terraform state list
  ```

---
## üìå –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏
- [–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Terraform](https://developer.hashicorp.com/terraform/docs)
- [–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Yandex Cloud](https://cloud.yandex.ru/docs)
- [Kubernetes](https://kubernetes.io/docs/)
- [Helm Charts](https://artifacthub.io/)
